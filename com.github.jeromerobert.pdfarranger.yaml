---
id: com.github.jeromerobert.pdfarranger
runtime: org.gnome.Platform
runtime-version: '3.34'
sdk: org.gnome.Sdk
command: pdfarranger
rename-icon: pdfarranger
rename-desktop-file: pdfarranger.desktop
rename-appdata-file: pdfarranger.appdata.xml
modules:
- name: intltool
  cleanup: [ "*" ]
  sources:
  - type: archive
    url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
    sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd
- name: openjpeg # dependency of poppler
  buildsystem: cmake
  sources:
  - url: https://github.com/uclouvain/openjpeg/archive/v2.3.1.tar.gz
    sha256: 63f5a4713ecafc86de51bfad89cc07bb788e9bba24ebbf0c4ca637621aadb6a9
    type: archive
    config-opts: [ "-DBUILD_STATIC_LIBS=OFF" ]
- name: poppler
  buildsystem: cmake
  sources:
  - url: https://poppler.freedesktop.org/poppler-0.86.1.tar.xz
    sha256: af630a277c8e194c31339c5446241834aed6ed3d4b4dc7080311e51c66257f6c
    type: archive
    config-opts: 
    - "-DENABLE_UTILS=OFF"
    - "-DENABLE_CPP=OFF"
    - "-DENABLE_QT5=OFF"
- name: python-distutils-extra
  buildsystem: simple
  sources:
  - url: https://launchpad.net/python-distutils-extra/trunk/2.39/+download/python-distutils-extra-2.39.tar.gz
    sha256: 723f24f4d65fc8d99b33a002fbbb3771d4cc9d664c97085bf37f3997ae8063af
    type: archive
  build-commands:
  - pip3 install --prefix=/app .
- name: pikepdf
  buildsystem: simple
  build-commands:
  - pip3 install --no-index --prefix=$FLATPAK_DEST lxml-*.whl pikepdf-*.whl
  sources:
  - type: file
    url: https://files.pythonhosted.org/packages/25/a0/816397f097ec58af4a9959130c0f748861ecf29d71e1f184b868738aa203/pikepdf-1.8.1-cp37-cp37m-manylinux2010_x86_64.whl
    sha256: ce43742788e5757877b6d83134f8a554aef8fc90990a844075464b757bc57cd8
  - type: file
    url: https://files.pythonhosted.org/packages/95/60/552fc6e027bc1158ba4691cccfdf6eb77f206f2f21d3c1c5f23b89f68a0e/lxml-4.4.2-cp37-cp37m-manylinux1_x86_64.whl
    sha256: 61409bd745a265a742f2693e4600e4dbd45cc1daebe1d5fad6fcb22912d44145
- name: pdfarranger
  buildsystem: simple
  sources:
  - url: https://github.com/jeromerobert/pdfarranger
    commit: master
    type: git
  build-commands:
  - pip3 install --prefix=/app .
cleanup:
- /include
- /lib/pkgconfig
- /app/lib/openjpeg-2.3
- /app/bin/opj_*
finish-args:
- --socket=wayland
- --socket=x11
- --share=ipc
- --filesystem=home
- --filesystem=xdg-run/dconf
- --filesystem=~/.config/dconf:ro
- --talk-name=ca.desrt.dconf
- --env=DCONF_USER_CONFIG_DIR=.config/dconf
