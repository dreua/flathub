---
id: com.github.jeromerobert.pdfarranger
runtime: org.gnome.Platform
runtime-version: '3.34'
sdk: org.gnome.Sdk
command: pdfarranger
modules:
- name: intltool
  cleanup: [ "*" ]
  sources:
  - type: archive
    url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
    sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd
- name: openjpeg # dependency of poppler
  buildsystem: cmake
  sources:
  - url: https://github.com/uclouvain/openjpeg/archive/v2.3.1.tar.gz
    sha256: 63f5a4713ecafc86de51bfad89cc07bb788e9bba24ebbf0c4ca637621aadb6a9
    type: archive
    config-opts: [ "-DBUILD_STATIC_LIBS=OFF" ]
- name: poppler
  buildsystem: cmake
  sources:
  - url: https://poppler.freedesktop.org/poppler-0.86.1.tar.xz
    sha256: af630a277c8e194c31339c5446241834aed6ed3d4b4dc7080311e51c66257f6c
    type: archive
    config-opts: 
    - "-DENABLE_UTILS=OFF"
    - "-DENABLE_CPP=OFF"
    - "-DENABLE_QT5=OFF"
- name: python-distutils-extra
  buildsystem: simple
  sources:
  - url: https://launchpad.net/python-distutils-extra/trunk/2.39/+download/python-distutils-extra-2.39.tar.gz
    sha256: 723f24f4d65fc8d99b33a002fbbb3771d4cc9d664c97085bf37f3997ae8063af
    type: archive
  build-commands:
  - pip3 install --prefix=/app .
- name: pikepdf
  buildsystem: simple
  build-commands:
  - pip3 install --no-index --prefix=$FLATPAK_DEST lxml-*.whl pikepdf-*.whl
  sources:
  - type: file
    url: https://files.pythonhosted.org/packages/38/e8/9cce836a4b910e3928125d5566592b6531a791cfd7e90636d5104c497c65/pikepdf-1.10.3-cp37-cp37m-manylinux2010_x86_64.whl
    sha256: 9f05a5f74ba58a2ae050da1bca44a0663f5ef94f42255225f44e38d0c60439af
  - type: file
    url: https://files.pythonhosted.org/packages/85/9e/93e2c3af278c7c8b6826666bbcb145af2829bd761c3b329e51cd6343836c/lxml-4.5.0-cp37-cp37m-manylinux1_x86_64.whl
    sha256: fd52e796fee7171c4361d441796b64df1acfceb51f29e545e812f16d023c4bbc
- name: pdfarranger
  buildsystem: simple
  sources:
  - url: https://github.com/dreua/pdfarranger
    commit: "4efc49c036738cdfafc3dc7cc7c35b12efa48530" # appid-prefix/Fix icon path
    type: git
  build-commands:
  - pip3 install --prefix=/app .
cleanup:
- /include
- /lib/pkgconfig
- /app/lib/openjpeg-2.3
- /app/bin/opj_*
finish-args:
- --socket=wayland
- --socket=x11
- --share=ipc
- --filesystem=home
- --filesystem=xdg-run/dconf
- --filesystem=~/.config/dconf:ro
- --talk-name=ca.desrt.dconf
- --env=DCONF_USER_CONFIG_DIR=.config/dconf
